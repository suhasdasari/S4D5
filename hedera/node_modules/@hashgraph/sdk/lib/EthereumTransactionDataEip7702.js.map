{"version":3,"file":"EthereumTransactionDataEip7702.js","sources":["../src/EthereumTransactionDataEip7702.js"],"sourcesContent":["import * as rlp from \"@ethersproject/rlp\";\nimport * as hex from \"./encoding/hex.js\";\nimport EthereumTransactionData from \"./EthereumTransactionData.js\";\nimport CACHE from \"./Cache.js\";\n\n/**\n * @typedef {object} EthereumTransactionDataEip7702JSON\n * @property {string} chainId\n * @property {string} nonce\n * @property {string} maxPriorityGas\n * @property {string} maxGas\n * @property {string} gasLimit\n * @property {string} to\n * @property {string} value\n * @property {string} callData\n * @property {Array<[string, string, string, string, string, string]>} authorizationList - Array of [chainId, contractAddress, nonce, yParity, r, s] tuples\n * @property {string[]} accessList\n * @property {string} recId\n * @property {string} r\n * @property {string} s\n */\n\nexport default class EthereumTransactionDataEip7702 extends EthereumTransactionData {\n    /**\n     * @private\n     * @param {object} props\n     * @param {Uint8Array} props.chainId\n     * @param {Uint8Array} props.nonce\n     * @param {Uint8Array} props.maxPriorityGas\n     * @param {Uint8Array} props.maxGas\n     * @param {Uint8Array} props.gasLimit\n     * @param {Uint8Array} props.to\n     * @param {Uint8Array} props.value\n     * @param {Uint8Array} props.callData\n     * @param {Array<[Uint8Array, Uint8Array, Uint8Array, Uint8Array, Uint8Array, Uint8Array]>} props.authorizationList - Array of [chainId, contractAddress, nonce, yParity, r, s] tuples\n     * @param {Uint8Array[]} props.accessList\n     * @param {Uint8Array} props.recId\n     * @param {Uint8Array} props.r\n     * @param {Uint8Array} props.s\n     */\n    constructor(props) {\n        super(props);\n\n        this.chainId = props.chainId;\n        this.nonce = props.nonce;\n        this.maxPriorityGas = props.maxPriorityGas;\n        this.maxGas = props.maxGas;\n        this.gasLimit = props.gasLimit;\n        this.to = props.to;\n        this.value = props.value;\n        this.callData = props.callData;\n        this.authorizationList = props.authorizationList;\n        this.accessList = props.accessList;\n        this.recId = props.recId;\n        this.r = props.r;\n        this.s = props.s;\n    }\n\n    /**\n     * @param {Uint8Array} bytes\n     * @returns {EthereumTransactionData}\n     */\n    static fromBytes(bytes) {\n        if (bytes.length === 0) {\n            throw new Error(\"empty bytes\");\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const decoded = /** @type {string[]} */ (rlp.decode(bytes.subarray(1)));\n\n        if (!Array.isArray(decoded)) {\n            throw new Error(\"ethereum data is not a list\");\n        }\n\n        if (decoded.length !== 13) {\n            throw new Error(\"invalid ethereum transaction data\");\n        }\n\n        // Decode authorization list: array of [chainId, contractAddress, nonce, yParity, r, s] tuples\n        // Authorization list can be empty (empty array is valid)\n        if (!Array.isArray(decoded[9])) {\n            throw new Error(\"authorization list must be an array\");\n        }\n        // @ts-ignore\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        const authorizationList = /** @type {string[]} */ (decoded[9]).map(\n            (authTuple) => {\n                if (!Array.isArray(authTuple) || authTuple.length !== 6) {\n                    throw new Error(\n                        \"invalid authorization list entry: must be [chainId, contractAddress, nonce, yParity, r, s]\",\n                    );\n                }\n                return [\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                    hex.decode(/** @type {string} */ (authTuple[0])), // chainId\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                    hex.decode(/** @type {string} */ (authTuple[1])), // contractAddress (20 bytes)\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                    hex.decode(/** @type {string} */ (authTuple[2])), // nonce\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                    hex.decode(/** @type {string} */ (authTuple[3])), // yParity (0 or 1)\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                    hex.decode(/** @type {string} */ (authTuple[4])), // r (32 bytes)\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                    hex.decode(/** @type {string} */ (authTuple[5])), // s (32 bytes)\n                ];\n            },\n        );\n\n        return new EthereumTransactionDataEip7702({\n            chainId: hex.decode(/** @type {string} */ (decoded[0])),\n            nonce: hex.decode(/** @type {string} */ (decoded[1])),\n            maxPriorityGas: hex.decode(/** @type {string} */ (decoded[2])),\n            maxGas: hex.decode(/** @type {string} */ (decoded[3])),\n            gasLimit: hex.decode(/** @type {string} */ (decoded[4])),\n            to: hex.decode(/** @type {string} */ (decoded[5])),\n            value: hex.decode(/** @type {string} */ (decoded[6])),\n            callData: hex.decode(/** @type {string} */ (decoded[7])),\n            // @ts-ignore\n            accessList: /** @type {string[]} */ (decoded[8]).map((v) =>\n                hex.decode(v),\n            ),\n            // @ts-ignore\n            authorizationList: authorizationList,\n            recId: hex.decode(/** @type {string} */ (decoded[10])),\n            r: hex.decode(/** @type {string} */ (decoded[11])),\n            s: hex.decode(/** @type {string} */ (decoded[12])),\n        });\n    }\n\n    /**\n     * @returns {Uint8Array}\n     */\n    toBytes() {\n        const encoded = rlp.encode([\n            this.chainId,\n            this.nonce,\n            this.maxPriorityGas,\n            this.maxGas,\n            this.gasLimit,\n            this.to,\n            this.value,\n            this.callData,\n            this.accessList,\n            this.authorizationList,\n            this.recId,\n            this.r,\n            this.s,\n        ]);\n        return hex.decode(\"04\" + encoded.substring(2));\n    }\n\n    /**\n     * @returns {string}\n     */\n    toString() {\n        return JSON.stringify(this.toJSON(), null, 2);\n    }\n\n    /**\n     * @returns {EthereumTransactionDataEip7702JSON}\n     */\n    toJSON() {\n        return {\n            chainId: hex.encode(this.chainId),\n            nonce: hex.encode(this.nonce),\n            maxPriorityGas: hex.encode(this.maxPriorityGas),\n            maxGas: hex.encode(this.maxGas),\n            gasLimit: hex.encode(this.gasLimit),\n            to: hex.encode(this.to),\n            value: hex.encode(this.value),\n            callData: hex.encode(this.callData),\n            authorizationList: this.authorizationList.map(\n                ([chainId, contractAddress, nonce, yParity, r, s]) => [\n                    hex.encode(chainId),\n                    hex.encode(contractAddress),\n                    hex.encode(nonce),\n                    hex.encode(yParity),\n                    hex.encode(r),\n                    hex.encode(s),\n                ],\n            ),\n            accessList: this.accessList.map((v) => hex.encode(v)),\n            recId: hex.encode(this.recId),\n            r: hex.encode(this.r),\n            s: hex.encode(this.s),\n        };\n    }\n}\n\nCACHE.setEthereumTransactionDataEip7702FromBytes((bytes) =>\n    EthereumTransactionDataEip7702.fromBytes(bytes),\n);\n"],"names":["EthereumTransactionDataEip7702","EthereumTransactionData","constructor","props","super","this","chainId","nonce","maxPriorityGas","maxGas","gasLimit","to","value","callData","authorizationList","accessList","recId","r","s","fromBytes","bytes","length","Error","decoded","rlp","decode","subarray","Array","isArray","map","authTuple","hex.decode","v","toBytes","encoded","encode","substring","toString","JSON","stringify","toJSON","hex.encode","contractAddress","yParity","CACHE","setEthereumTransactionDataEip7702FromBytes"],"mappings":"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"}