{
  "language": "Solidity",
  "sources": {
    "@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol": {
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\n// solhint-disable-next-line interface-starts-with-i\ninterface AggregatorV3Interface {\n  function decimals() external view returns (uint8);\n\n  function description() external view returns (string memory);\n\n  function version() external view returns (uint256);\n\n  function getRoundData(\n    uint80 _roundId\n  ) external view returns (uint80 roundId, int256 answer, uint256 startedAt, uint256 updatedAt, uint80 answeredInRound);\n\n  function latestRoundData()\n    external\n    view\n    returns (uint80 roundId, int256 answer, uint256 startedAt, uint256 updatedAt, uint80 answeredInRound);\n}\n"
    },
    "contracts/ChainlinkPriceOracle.sol": {
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.20;\n\nimport \"@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol\";\n\n/**\n * @title ChainlinkPriceOracle\n * @notice Production-ready price oracle using Chainlink Price Feeds\n * @dev Converts token prices to USDC terms using Chainlink data feeds\n * \n * Chainlink Price Feeds on Base:\n * - ETH/USD: 0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70\n * - BTC/USD: 0x64c911996D3c6aC71f9b455B1E8E7266BcbD848F\n * - More feeds: https://docs.chain.link/data-feeds/price-feeds/addresses?network=base\n */\ncontract ChainlinkPriceOracle {\n    // Owner can add/update price feeds\n    address public owner;\n    \n    // Token address => Chainlink price feed address\n    mapping(address => address) public priceFeeds;\n    \n    // Token address => decimals adjustment (to normalize to 6 decimals for USDC)\n    mapping(address => uint8) public tokenDecimals;\n    \n    // Events\n    event PriceFeedSet(address indexed token, address indexed feed, uint8 decimals, uint256 timestamp);\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\n    \n    constructor() {\n        owner = msg.sender;\n    }\n    \n    modifier onlyOwner() {\n        require(msg.sender == owner, \"Not owner\");\n        _;\n    }\n    \n    /**\n     * @notice Get price of token in USDC terms\n     * @param token Address of token to price\n     * @return price Price in USDC (6 decimals)\n     */\n    function getPrice(address token) external view returns (uint256 price) {\n        address feedAddress = priceFeeds[token];\n        require(feedAddress != address(0), \"Price feed not set for token\");\n        \n        AggregatorV3Interface priceFeed = AggregatorV3Interface(feedAddress);\n        \n        // Get latest price from Chainlink\n        (\n            /* uint80 roundID */,\n            int256 answer,\n            /* uint256 startedAt */,\n            uint256 updatedAt,\n            /* uint80 answeredInRound */\n        ) = priceFeed.latestRoundData();\n        \n        require(answer > 0, \"Invalid price from Chainlink\");\n        require(updatedAt > 0, \"Price data not updated\");\n        require(block.timestamp - updatedAt < 1 hours, \"Price data stale\");\n        \n        // Chainlink price feeds typically have 8 decimals\n        // We need to convert to 6 decimals for USDC\n        uint8 feedDecimals = priceFeed.decimals();\n        uint256 rawPrice = uint256(answer);\n        \n        // Convert to 6 decimals (USDC standard)\n        if (feedDecimals > 6) {\n            price = rawPrice / (10 ** (feedDecimals - 6));\n        } else if (feedDecimals < 6) {\n            price = rawPrice * (10 ** (6 - feedDecimals));\n        } else {\n            price = rawPrice;\n        }\n        \n        // Adjust for token decimals if needed\n        // For example, if token has 18 decimals and we're pricing 1 token\n        // we need to account for that in the final price calculation\n        uint8 tokenDecimal = tokenDecimals[token];\n        if (tokenDecimal > 0 && tokenDecimal != 18) {\n            // Adjust price based on token decimals\n            // This ensures proper valuation in totalAssets()\n            if (tokenDecimal < 18) {\n                price = price * (10 ** (18 - tokenDecimal));\n            } else {\n                price = price / (10 ** (tokenDecimal - 18));\n            }\n        }\n        \n        return price;\n    }\n    \n    /**\n     * @notice Set Chainlink price feed for a token\n     * @param token Address of token\n     * @param feed Address of Chainlink price feed\n     * @param decimals Token decimals (e.g., 18 for WETH, 8 for WBTC)\n     */\n    function setPriceFeed(address token, address feed, uint8 decimals) external onlyOwner {\n        require(token != address(0), \"Invalid token\");\n        require(feed != address(0), \"Invalid feed\");\n        require(decimals > 0 && decimals <= 18, \"Invalid decimals\");\n        \n        // Verify the feed is valid by calling it\n        AggregatorV3Interface priceFeed = AggregatorV3Interface(feed);\n        priceFeed.latestRoundData(); // Will revert if feed is invalid\n        \n        priceFeeds[token] = feed;\n        tokenDecimals[token] = decimals;\n        \n        emit PriceFeedSet(token, feed, decimals, block.timestamp);\n    }\n    \n    /**\n     * @notice Set multiple price feeds at once\n     * @param tokens Array of token addresses\n     * @param feeds Array of Chainlink price feed addresses\n     * @param decimals Array of token decimals\n     */\n    function setPriceFeeds(\n        address[] calldata tokens,\n        address[] calldata feeds,\n        uint8[] calldata decimals\n    ) external onlyOwner {\n        require(\n            tokens.length == feeds.length && tokens.length == decimals.length,\n            \"Array length mismatch\"\n        );\n        \n        for (uint256 i = 0; i < tokens.length; i++) {\n            require(tokens[i] != address(0), \"Invalid token\");\n            require(feeds[i] != address(0), \"Invalid feed\");\n            require(decimals[i] > 0 && decimals[i] <= 18, \"Invalid decimals\");\n            \n            // Verify the feed is valid\n            AggregatorV3Interface priceFeed = AggregatorV3Interface(feeds[i]);\n            priceFeed.latestRoundData();\n            \n            priceFeeds[tokens[i]] = feeds[i];\n            tokenDecimals[tokens[i]] = decimals[i];\n            \n            emit PriceFeedSet(tokens[i], feeds[i], decimals[i], block.timestamp);\n        }\n    }\n    \n    /**\n     * @notice Check if price feed is set for a token\n     * @param token Address of token\n     * @return True if price feed is set\n     */\n    function hasPriceFeed(address token) external view returns (bool) {\n        return priceFeeds[token] != address(0);\n    }\n    \n    /**\n     * @notice Get price feed address for a token\n     * @param token Address of token\n     * @return Address of Chainlink price feed\n     */\n    function getPriceFeed(address token) external view returns (address) {\n        return priceFeeds[token];\n    }\n    \n    /**\n     * @notice Transfer ownership\n     * @param newOwner Address of new owner\n     */\n    function transferOwnership(address newOwner) external onlyOwner {\n        require(newOwner != address(0), \"Invalid new owner\");\n        address oldOwner = owner;\n        owner = newOwner;\n        emit OwnershipTransferred(oldOwner, newOwner);\n    }\n}\n"
    }
  },
  "settings": {
    "optimizer": {
      "enabled": true,
      "runs": 200
    },
    "evmVersion": "paris",
    "outputSelection": {
      "*": {
        "*": [
          "abi",
          "evm.bytecode",
          "evm.deployedBytecode",
          "evm.methodIdentifiers",
          "metadata",
          "devdoc",
          "userdoc",
          "storageLayout",
          "evm.gasEstimates"
        ],
        "": [
          "ast"
        ]
      }
    },
    "metadata": {
      "useLiteralContent": true
    }
  }
}